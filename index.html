<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>EscÃ¡ner de Productos</title>

<style>
body {
    font-family: Arial, sans-serif;
    background:#f3f6ff;
    padding:20px;
}

h2 {
    text-align:center;
    color:#2c4cff;
}

input, button {
    padding:8px;
    margin:5px;
    border-radius:6px;
    border:1px solid #999;
}

button {
    background:#2c4cff;
    color:white;
    border:none;
    cursor:pointer;
}

table {
    width:100%;
    border-collapse:collapse;
    margin-top:15px;
}

th, td {
    border:1px solid #ccc;
    padding:8px;
    text-align:center;
}

th {
    background:#dfe3ff;
}

#btnScanner {
    position:fixed;
    bottom:20px;
    right:20px;
    width:60px;
    height:60px;
    border-radius:50%;
    font-size:26px;
    background:#2ecc71;
    color:white;
    border:none;
}

#scanner {
    position:fixed;
    inset:0;
    background:black;
    display:none;
    z-index:2000;
}

#camera {
    width:100%;
    height:80%;
}

#scanner button {
    width:100%;
    padding:15px;
    background:#e74c3c;
    font-size:18px;
}

#infoProducto {
    margin-top:15px;
    padding:12px;
    background:white;
    border-radius:10px;
    text-align:center;
    font-size:16px;
}
</style>
</head>

<body>

<h2>EscÃ¡ner de Productos</h2>

<label>Tasa del dÃ³lar (USD â†’ Bs):</label>
<input type="number" id="tasa" placeholder="Ej: 40">

<div id="infoProducto">Escanea un producto ðŸ“¸</div>

<h3>Agregar producto</h3>
<input type="text" id="nombre" placeholder="Nombre">
<input type="number" id="precio" placeholder="Precio USD">
<button onclick="agregarProducto()">Agregar</button>

<table>
<thead>
<tr>
    <th>Producto</th>
    <th>USD</th>
    <th>CÃ³digo</th>
</tr>
</thead>
<tbody id="tabla"></tbody>
</table>

<button id="btnScanner" onclick="abrirScanner()">ðŸ“¸</button>

<!-- SCANNER -->
<div id="scanner">
    <div id="camera"></div>
    <button onclick="cerrarScanner()">Cerrar</button>
</div>

<script src="https://unpkg.com/quagga@0.12.1/dist/quagga.min.js"></script>

<script>
let productos = JSON.parse(localStorage.getItem("productos") || "[]");

function guardarProductos() {
    localStorage.setItem("productos", JSON.stringify(productos));
}

function renderizar() {
    const tbody = document.getElementById("tabla");
    tbody.innerHTML = "";
    productos.forEach(p => {
        tbody.innerHTML += `
            <tr>
                <td>${p.nombre}</td>
                <td>$${p.usd}</td>
                <td>${p.codigo}</td>
            </tr>
        `;
    });
}

function agregarProducto() {
    const nombre = document.getElementById("nombre").value.trim();
    const usd = parseFloat(document.getElementById("precio").value);
    if (!nombre || isNaN(usd)) return alert("Datos invÃ¡lidos");

    const codigo = prompt("CÃ³digo de barras:");
    if (!codigo) return;

    productos.push({ nombre, usd, codigo });
    guardarProductos();
    renderizar();

    document.getElementById("nombre").value = "";
    document.getElementById("precio").value = "";
}

function abrirScanner() {
    document.getElementById("scanner").style.display = "block";

    Quagga.init({
        inputStream: {
            type: "LiveStream",
            target: document.querySelector("#camera"),
            constraints: { facingMode: "environment" }
        },
        decoder: {
            readers: ["ean_reader", "upc_reader"]
        }
    }, err => {
        if (err) return alert("Error cÃ¡mara");
        Quagga.start();
    });

    Quagga.offDetected(detectar);
    Quagga.onDetected(detectar);
}

function cerrarScanner() {
    Quagga.stop();
    document.getElementById("scanner").style.display = "none";
}

function detectar(data) {
    const codigo = data.codeResult.code;
    const prod = productos.find(p => p.codigo === codigo);

    if (prod) {
        const tasa = parseFloat(document.getElementById("tasa").value) || 0;
        document.getElementById("infoProducto").innerHTML = `
            <strong>${prod.nombre}</strong><br>
            ðŸ’µ USD: $${prod.usd}<br>
            ðŸ’´ Bs: ${(prod.usd * tasa).toFixed(2)}
        `;
    } else {
        alert("Producto no registrado");
    }

    cerrarScanner();
    Quagga.offDetected(detectar);
}

renderizar();
</script>

</body>
</html>
